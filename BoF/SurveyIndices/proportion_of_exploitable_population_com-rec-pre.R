
#Load libraries
library(ROracle)
library(tidyverse)
library(ggplot2)
library(PBSmapping)
library(cowplot)
library(grid)
library(gridExtra)

#Oracle credentials
uid <- keyring::key_list("Oracle")[1,2]
pwd <- keyring::key_get("Oracle", uid)

#Set up
path.directory <- "Y:/Inshore/BoF/"
spa3area <- read.csv("Y:/Inshore/Databases/Scallsur/SPA3/SPA3_VMSpoly.csv") #SPA3
inVMS <- read.csv("Y:/Inshore/BoF/2015/SPA6/Survey/SPA6_VMS_IN_R_final_MOD.csv") #SPA6
outvms <- read.csv("Y:/Inshore/BoF/2015/SPA6/Survey/SPA6_VMS_OUT_R_final_MOD.csv") #SPA6
chan <-dbConnect(dbDriver("Oracle"),username=uid, password=pwd,'ptran')

#Read in functions from Github
funcs <- "https://raw.githubusercontent.com/Mar-scal/Assessment_fns/master/Survey_and_OSAC/convert.dd.dddd.r"
dir <- getwd()
for(fun in funcs)
{
  temp <- dir
  download.file(fun,destfile = basename(fun))
  source(paste0(dir,"/",basename(fun)))
  file.remove(paste0(dir,"/",basename(fun)))
}

#--- SPA1A ----

# read in shell height and meat weight data from database
query1 <- paste(
  "SELECT * 			                ",
  "FROM scallsur.scliveres s			",
  " LEFT JOIN                          ",
  " 	(SELECT tow_date, cruise, tow_no     ",
  "	 FROM SCALLSUR.sctows) t             ",
  "on (s.cruise = t.cruise and s.tow_no = t.tow_no)",
  "where strata_id in (6,7,12,13,14,15,16,17,18,19,20,39)    ",
  sep=""
)

SPA1A.livefreq <- dbGetQuery(chan, query1)
SPA1A.livefreq  <- SPA1A.livefreq[,1:51] #remove duplicate columns


#Add up Bins >40mm and Bins >80
SPA1A.livefreq <- SPA1A.livefreq %>%
  mutate(YEAR = year(TOW_DATE)) %>%  #Formats TOW_DATE as date
  filter(YEAR >= 1997) %>%
  mutate(tot = dplyr::select(., BIN_ID_0:BIN_ID_195) %>% rowSums(na.rm = TRUE)) %>%
  mutate(com = dplyr::select(., BIN_ID_80:BIN_ID_195) %>% rowSums(na.rm = TRUE)) %>%
  mutate(rec = dplyr::select(., BIN_ID_65:BIN_ID_75) %>% rowSums(na.rm = TRUE)) %>%
  mutate(pre = dplyr::select(., BIN_ID_0:BIN_ID_60) %>% rowSums(na.rm = TRUE))

#Summarize: Group by Year
SPA1A.tot_by_year <- SPA1A.livefreq %>%
  group_by(YEAR) %>%
  summarise(tot = sum(tot),
            com = sum(com),
            rec = sum(rec),
            pre = sum(pre)) %>%
  mutate(prop.com = com/tot)%>%
  mutate(prop.rec = rec/tot)%>%
  mutate(prop.pre = pre/tot)

SPA1A.tot_by_year <- SPA1A.tot_by_year %>%
  add_row(YEAR = 2020, tot = NA, com = NA, rec = NA, pre = NA, prop.com = NA, prop.rec = NA, prop.pre = NA) %>%
  add_row(YEAR = 1983, tot = NA, com = NA, rec = NA, pre = NA, prop.com = NA, prop.rec = NA, prop.pre = NA) #only adding so the axis labels match SPA4

SPA1A.tot_by_year <- reshape2::melt(SPA1A.tot_by_year, id.vars = "YEAR", value.name = "value")

SPA1A.tot_by_year <- SPA1A.tot_by_year %>% filter(variable %in% c('prop.com','prop.rec', 'prop.pre'))

#ltm.SPA1A <- median(SPA1A.tot_by_year$prop, na.rm = TRUE)

#PLOT
SPA1A.plot <- ggplot() +
  geom_point(data=SPA1A.tot_by_year[SPA1A.tot_by_year$variable%in%c('prop.com','prop.rec', 'prop.pre'),],
             aes(YEAR, value, color=factor(variable, levels = c('prop.com','prop.rec', 'prop.pre')), shape=factor(variable, levels = c('prop.com','prop.rec', 'prop.pre'))), size = 2, stat="identity")+
  geom_line(data=SPA1A.tot_by_year[SPA1A.tot_by_year$variable%in%c('prop.com','prop.rec', 'prop.pre'),],
            aes(YEAR, value, color=factor(variable, levels = c('prop.com','prop.rec', 'prop.pre')),linetype = factor(variable, levels = c('prop.com','prop.rec', 'prop.pre'))), stat="identity")+
  geom_hline(yintercept = 1.0, color = "red",linetype = "longdash") +
  #geom_segment(aes(x = 1997, xend = max(YEAR), y = ltm.SPA1A, yend = ltm.SPA1A), color = "blue", linetype = "solid")+
  ylim(0, 1.0)+ xlim(1983,2025)+
  scale_x_continuous(breaks = seq(1980, 2025, by = 5))+
  scale_color_manual(values=c("black", "yellow3", "skyblue3"), labels=c("Commercial Scallop - \u2265 80mm", "Recruit Scallop - 65mm-79mm", "Pre-recruit Scallop - 0mm-64mm"), name=NULL) +
  scale_linetype_manual(values=c("solid", "twodash", "dotted"), labels=c("Commercial Scallop - \u2265 80mm", "Recruit Scallop - 65mm-79mm", "Pre-recruit Scallop - 0mm-64mm"), name=NULL) +
  scale_shape_manual(values=c(16,17,18), labels=c("Commercial Scallop - \u2265 80mm", "Recruit Scallop - 65mm-79mm", "Pre-recruit Scallop - 0mm-64mm"), name=NULL) +
  labs(
    title = "SPA 1A")+
  theme_bw()+
  theme(axis.title.x=element_blank(), axis.title.y=element_blank(), plot.title = element_text(size = 10),
        legend.position = c(0.175, 0.5), legend.background = element_blank(),
              legend.key.width = unit(0.5, "cm"),legend.text=element_text(size=8)) #
SPA1A.plot

#--- SPA1B ----

# read in shell height and meat weight data from database
query2 <- paste(
  "SELECT * 			                ",
  "FROM scallsur.scliveres s			",
  " LEFT JOIN                          ",
  " 	(SELECT tow_date, cruise, tow_no     ",
  "	 FROM SCALLSUR.sctows) t             ",
  "on (s.cruise = t.cruise and s.tow_no = t.tow_no)",
  "where strata_id in (35, 37, 38, 49, 51, 52, 53)    ",
  sep=""
)
SPA1B.livefreq <- dbGetQuery(chan, query2)
SPA1B.livefreq  <- SPA1B.livefreq[,1:51] #remove duplicate columns

#Add up Bins >40mm and Bins >80
SPA1B.livefreq <- SPA1B.livefreq %>%
  mutate(YEAR = year(TOW_DATE)) %>%  #Formats TOW_DATE as date
  filter(YEAR >= 1997) %>%
  mutate(tot = dplyr::select(., BIN_ID_0:BIN_ID_195) %>% rowSums(na.rm = TRUE)) %>%
  mutate(com = dplyr::select(., BIN_ID_80:BIN_ID_195) %>% rowSums(na.rm = TRUE)) %>%
  mutate(rec = dplyr::select(., BIN_ID_65:BIN_ID_75) %>% rowSums(na.rm = TRUE)) %>%
  mutate(pre = dplyr::select(., BIN_ID_0:BIN_ID_60) %>% rowSums(na.rm = TRUE))

#Summarize: Group by Year
SPA1B.tot_by_year <- SPA1B.livefreq %>%
  group_by(YEAR) %>%
  summarise(tot = sum(tot),
            com = sum(com),
            rec = sum(rec),
            pre = sum(pre)) %>%
  mutate(prop.com = com/tot)%>%
  mutate(prop.rec = rec/tot)%>%
  mutate(prop.pre = pre/tot)

SPA1B.tot_by_year <- SPA1B.tot_by_year %>%
  add_row(YEAR = 2020, tot = NA, com = NA, rec = NA, pre = NA, prop.com = NA, prop.rec = NA, prop.pre = NA) %>%
  add_row(YEAR = 1983, tot = NA, com = NA, rec = NA, pre = NA, prop.com = NA, prop.rec = NA, prop.pre = NA) #only adding so the axis labels match SPA4

SPA1B.tot_by_year <- reshape2::melt(SPA1B.tot_by_year, id.vars = "YEAR", value.name = "value")

SPA1B.tot_by_year <- SPA1B.tot_by_year %>% filter(variable %in% c('prop.com','prop.rec', 'prop.pre'))

#ltm.SPA1A <- median(SPA1A.tot_by_year$prop, na.rm = TRUE)

#PLOT
SPA1B.plot <- ggplot() +
  geom_point(data=SPA1B.tot_by_year[SPA1B.tot_by_year$variable%in%c('prop.com','prop.rec', 'prop.pre'),],
             aes(YEAR, value, color=factor(variable, levels = c('prop.com','prop.rec', 'prop.pre')), shape=factor(variable, levels = c('prop.com','prop.rec', 'prop.pre'))), size = 2, stat="identity")+
  geom_line(data=SPA1B.tot_by_year[SPA1B.tot_by_year$variable%in%c('prop.com','prop.rec', 'prop.pre'),],
            aes(YEAR, value, color=factor(variable, levels = c('prop.com','prop.rec', 'prop.pre')),linetype = factor(variable, levels = c('prop.com','prop.rec', 'prop.pre'))), stat="identity")+
  geom_hline(yintercept = 1.0, color = "red",linetype = "longdash") +
  #geom_segment(aes(x = 1997, xend = max(YEAR), y = ltm.SPA1A, yend = ltm.SPA1A), color = "blue", linetype = "solid")+
  ylim(0, 1.0)+ xlim(1983,2025)+
  scale_x_continuous(breaks = seq(1980, 2025, by = 5))+
  scale_color_manual(values=c("black", "yellow3", "skyblue3"), labels=c("Commercial Scallop - \u2265 80mm", "Recruit Scallop - 65mm-79mm", "Pre-recruit Scallop - 0mm-64mm"), name=NULL) +
  scale_linetype_manual(values=c("solid", "twodash", "dotted"), labels=c("Commercial Scallop - \u2265 80mm", "Recruit Scallop - 65mm-79mm", "Pre-recruit Scallop - 0mm-64mm"), name=NULL) +
  labs(
    title = "SPA 1B")+
  theme_bw()+
  theme(axis.title.x=element_blank(), axis.title.y=element_blank(), plot.title = element_text(size = 10),
        legend.position = "none")
SPA1B.plot

#--- SPA3 ----

# read in shell height and meat weight data from database
query3 <- paste(
  "SELECT * 			                ",
  "FROM scallsur.scliveres s			",
  " LEFT JOIN                          ",
  " 	(SELECT tow_date, cruise, tow_no     ",
  "	 FROM SCALLSUR.sctows) t             ",
  "on (s.cruise = t.cruise and s.tow_no = t.tow_no)",
  "where strata_id in (22,23,24)    ",
  sep=""
)

SPA3.livefreq <- dbGetQuery(chan, query3)
SPA3.livefreq  <- SPA3.livefreq[,1:51] #remove duplicate columns

#Want inside vms only, so need to convert latlongs
SPA3.livefreq$lat <- convert.dd.dddd(SPA3.livefreq$START_LAT)
SPA3.livefreq$lon <- convert.dd.dddd(SPA3.livefreq$START_LONG)
SPA3.livefreq$ID <- 1:nrow(SPA3.livefreq)

#identify tows "inside" the VMS strata and assign new STRATA_ID to them (99)
events <- subset(SPA3.livefreq,STRATA_ID%in%23:24,c("ID","lon","lat"))
names(events) <- c("EID","X","Y")
SPA3.livefreq$STRATA_ID[SPA3.livefreq$ID%in%findPolys(events,spa3area)$EID] <- 99

#Select tows inside VMS only, and add up Bins >40mm and Bins >80
SPA3.livefreq <- SPA3.livefreq %>%
  mutate(YEAR = year(TOW_DATE)) %>%  #Formats TOW_DATE as date
  filter(STRATA_ID == 99) %>%
  filter(YEAR > 1995) %>%
  mutate(tot = dplyr::select(., BIN_ID_0:BIN_ID_195) %>% rowSums(na.rm = TRUE)) %>%
  mutate(com = dplyr::select(., BIN_ID_80:BIN_ID_195) %>% rowSums(na.rm = TRUE)) %>%
  mutate(rec = dplyr::select(., BIN_ID_65:BIN_ID_75) %>% rowSums(na.rm = TRUE)) %>%
  mutate(pre = dplyr::select(., BIN_ID_0:BIN_ID_60) %>% rowSums(na.rm = TRUE))

#Summarize: Group by Year
SPA3.tot_by_year <- SPA3.livefreq %>%
  group_by(YEAR) %>%
  summarise(tot = sum(tot),
            com = sum(com),
            rec = sum(rec),
            pre = sum(pre)) %>%
  mutate(prop.com = com/tot)%>%
  mutate(prop.rec = rec/tot)%>%
  mutate(prop.pre = pre/tot)

SPA3.tot_by_year <- SPA3.tot_by_year %>%
  add_row(YEAR = 2020, tot = NA, com = NA, rec = NA, pre = NA, prop.com = NA, prop.rec = NA, prop.pre = NA) %>%
  add_row(YEAR = 1983, tot = NA, com = NA, rec = NA, pre = NA, prop.com = NA, prop.rec = NA, prop.pre = NA) #only adding so the axis labels match SPA4

SPA3.tot_by_year <- reshape2::melt(SPA3.tot_by_year, id.vars = "YEAR", value.name = "value")

SPA3.tot_by_year <- SPA3.tot_by_year %>% filter(variable %in% c('prop.com','prop.rec', 'prop.pre'))

#ltm.SPA1A <- median(SPA1A.tot_by_year$prop, na.rm = TRUE)

#PLOT
SPA3.plot <- ggplot() +
  geom_point(data=SPA3.tot_by_year[SPA3.tot_by_year$variable%in%c('prop.com','prop.rec', 'prop.pre'),],
             aes(YEAR, value, color=factor(variable, levels = c('prop.com','prop.rec', 'prop.pre')), shape=factor(variable, levels = c('prop.com','prop.rec', 'prop.pre'))), size = 2, stat="identity")+
  geom_line(data=SPA3.tot_by_year[SPA3.tot_by_year$variable%in%c('prop.com','prop.rec', 'prop.pre'),],
            aes(YEAR, value, color=factor(variable, levels = c('prop.com','prop.rec', 'prop.pre')),linetype = factor(variable, levels = c('prop.com','prop.rec', 'prop.pre'))), stat="identity")+
  geom_hline(yintercept = 1.0, color = "red",linetype = "longdash") +
  #geom_segment(aes(x = 1997, xend = max(YEAR), y = ltm.SPA1A, yend = ltm.SPA1A), color = "blue", linetype = "solid")+
  ylim(0, 1.0)+ xlim(1983,2025)+
  scale_x_continuous(breaks = seq(1980, 2025, by = 5))+
  scale_color_manual(values=c("black", "yellow3", "skyblue3"), labels=c("Commercial Scallop - \u2265 80mm", "Recruit Scallop - 65mm-79mm", "Pre-recruit Scallop - 0mm-64mm"), name=NULL) +
  scale_linetype_manual(values=c("solid", "twodash", "dotted"), labels=c("Commercial Scallop - \u2265 80mm", "Recruit Scallop - 65mm-79mm", "Pre-recruit Scallop - 0mm-64mm"), name=NULL) +
  labs(
    title = "SPA 3")+
  theme_bw()+
  theme(axis.title.x=element_blank(), axis.title.y=element_blank(), plot.title = element_text(size = 10),
        legend.position = "none")
SPA3.plot

#--- SPA4 ----

# read in shell height and meat weight data from database
query4 <- paste(
  "SELECT * 			                ",
  "FROM scallsur.scliveres s			",
  " LEFT JOIN                          ",
  " 	(SELECT tow_date, cruise, tow_no     ",
  "	 FROM SCALLSUR.sctows) t             ",
  "on (s.cruise = t.cruise and s.tow_no = t.tow_no)",
  "where strata_id in (1,2,3,4,5,8,9,10)    ",
  sep=""
)

#Select data from database; execute query with ROracle
SPA4.livefreq <- dbGetQuery(chan, query4)
SPA4.livefreq  <- SPA4.livefreq[,1:51] #remove duplicate columns

#Add up Bins >40mm and Bins >80
SPA4.livefreq <- SPA4.livefreq %>%
  mutate(YEAR = year(TOW_DATE)) %>%  #Formats TOW_DATE as date
  filter(YEAR >= 1983) %>%
  mutate(tot = dplyr::select(., BIN_ID_0:BIN_ID_195) %>% rowSums(na.rm = TRUE)) %>%
  mutate(com = dplyr::select(., BIN_ID_80:BIN_ID_195) %>% rowSums(na.rm = TRUE)) %>%
  mutate(rec = dplyr::select(., BIN_ID_65:BIN_ID_75) %>% rowSums(na.rm = TRUE)) %>%
  mutate(pre = dplyr::select(., BIN_ID_0:BIN_ID_60) %>% rowSums(na.rm = TRUE))

#Summarize: Group by Year
SPA4.tot_by_year <- SPA4.livefreq %>%
  group_by(YEAR) %>%
  summarise(tot = sum(tot),
            com = sum(com),
            rec = sum(rec),
            pre = sum(pre)) %>%
  mutate(prop.com = com/tot)%>%
  mutate(prop.rec = rec/tot)%>%
  mutate(prop.pre = pre/tot)

SPA4.tot_by_year <- SPA4.tot_by_year %>%
  add_row(YEAR = 2020, tot = NA, com = NA, rec = NA, pre = NA, prop.com = NA, prop.rec = NA, prop.pre = NA) %>%
  add_row(YEAR = 1983, tot = NA, com = NA, rec = NA, pre = NA, prop.com = NA, prop.rec = NA, prop.pre = NA) #only adding so the axis labels match SPA4

SPA4.tot_by_year <- reshape2::melt(SPA4.tot_by_year, id.vars = "YEAR", value.name = "value")

SPA4.tot_by_year <- SPA4.tot_by_year %>% filter(variable %in% c('prop.com','prop.rec', 'prop.pre'))

#PLOT
SPA4.plot <- ggplot() +
  geom_point(data=SPA4.tot_by_year[SPA4.tot_by_year$variable%in%c('prop.com','prop.rec', 'prop.pre'),],
             aes(YEAR, value, color=factor(variable, levels = c('prop.com','prop.rec', 'prop.pre')), shape=factor(variable, levels = c('prop.com','prop.rec', 'prop.pre'))), size = 2, stat="identity")+
  geom_line(data=SPA4.tot_by_year[SPA4.tot_by_year$variable%in%c('prop.com','prop.rec', 'prop.pre'),],
            aes(YEAR, value, color=factor(variable, levels = c('prop.com','prop.rec', 'prop.pre')),linetype = factor(variable, levels = c('prop.com','prop.rec', 'prop.pre'))), stat="identity")+
  geom_hline(yintercept = 1.0, color = "red",linetype = "longdash") +
  #geom_segment(aes(x = 1997, xend = max(YEAR), y = ltm.SPA1A, yend = ltm.SPA1A), color = "blue", linetype = "solid")+
  ylim(0, 1.0)+ xlim(1983,2025)+
  scale_x_continuous(breaks = seq(1980, 2025, by = 5))+
  scale_color_manual(values=c("black", "yellow3", "skyblue3"), labels=c("Commercial Scallop - \u2265 80mm", "Recruit Scallop - 65mm-79mm", "Pre-recruit Scallop - 0mm-64mm"), name=NULL) +
  scale_linetype_manual(values=c("solid", "twodash", "dotted"), labels=c("Commercial Scallop - \u2265 80mm", "Recruit Scallop - 65mm-79mm", "Pre-recruit Scallop - 0mm-64mm"), name=NULL) +
  labs(
    title = "SPA 4")+
  theme_bw()+
  theme(axis.title.x=element_blank(), axis.title.y=element_blank(), plot.title = element_text(size = 10),
        legend.position = "none")
SPA4.plot


#--- SPA6 ----

# read in shell height and meat weight data from database
query5 <- "SELECT *
FROM scallsur.scliveres s
LEFT JOIN
(SELECT tow_date, cruise, tow_no
FROM SCALLSUR.sctows) t
on (s.cruise = t.cruise and s.tow_no = t.tow_no)
where strata_id in (30, 31, 32)"

SPA6.livefreq <- dbGetQuery(chan, query5)
SPA6.livefreq <- SPA6.livefreq[,1:51]
SPA6.livefreq$YEAR <- year(SPA6.livefreq$TOW_DATE)

#Only want data from tows inside VMS, convert lat longs
SPA6.livefreq$lat <- convert.dd.dddd(SPA6.livefreq$START_LAT)
SPA6.livefreq$lon <- convert.dd.dddd(SPA6.livefreq$START_LONG)
SPA6.livefreq$ID <- 1:nrow(SPA6.livefreq)

#identify tows "inside" the VMS strata and call them "IN" and tows "outside", "OUT".
SPA6.livefreq$VMSSTRATA <- ""
events <- subset(SPA6.livefreq,STRATA_ID%in%30:32,c("ID","lon","lat"))
names(events) <- c("EID","X","Y")
SPA6.livefreq$VMSSTRATA[SPA6.livefreq$ID%in%findPolys(events,inVMS)$EID] <- "IN"
SPA6.livefreq$VMSSTRATA[SPA6.livefreq$ID%in%findPolys(events,outvms)$EID] <- "OUT"

#Add up Bins >40mm and Bins >80
SPA6.livefreq <- SPA6.livefreq %>%
  mutate(YEAR = year(TOW_DATE)) %>%  #Formats TOW_DATE as date
  filter(VMSSTRATA == "IN") %>%
  filter(YEAR >= 2006) %>%
  mutate(tot = dplyr::select(., BIN_ID_0:BIN_ID_195) %>% rowSums(na.rm = TRUE)) %>%
  mutate(com = dplyr::select(., BIN_ID_80:BIN_ID_195) %>% rowSums(na.rm = TRUE)) %>%
  mutate(rec = dplyr::select(., BIN_ID_65:BIN_ID_75) %>% rowSums(na.rm = TRUE)) %>%
  mutate(pre = dplyr::select(., BIN_ID_0:BIN_ID_60) %>% rowSums(na.rm = TRUE))

#Summarize: Group by Year
SPA6.tot_by_year <- SPA6.livefreq %>%
  group_by(YEAR) %>%
  summarise(tot = sum(tot),
            com = sum(com),
            rec = sum(rec),
            pre = sum(pre)) %>%
  mutate(prop.com = com/tot)%>%
  mutate(prop.rec = rec/tot)%>%
  mutate(prop.pre = pre/tot)

SPA6.tot_by_year <- SPA6.tot_by_year %>%
  add_row(YEAR = 2020, tot = NA, com = NA, rec = NA, pre = NA, prop.com = NA, prop.rec = NA, prop.pre = NA) %>%
  add_row(YEAR = 1983, tot = NA, com = NA, rec = NA, pre = NA, prop.com = NA, prop.rec = NA, prop.pre = NA) #only adding so the axis labels match SPA4

SPA6.tot_by_year <- reshape2::melt(SPA6.tot_by_year, id.vars = "YEAR", value.name = "value")

SPA6.tot_by_year <- SPA6.tot_by_year %>% filter(variable %in% c('prop.com','prop.rec', 'prop.pre'))

#PLOT
SPA6.plot <- ggplot() +
  geom_point(data=SPA6.tot_by_year[SPA6.tot_by_year$variable%in%c('prop.com','prop.rec', 'prop.pre'),],
             aes(YEAR, value, color=factor(variable, levels = c('prop.com','prop.rec', 'prop.pre')), shape=factor(variable, levels = c('prop.com','prop.rec', 'prop.pre'))), size = 2, stat="identity")+
  geom_line(data=SPA6.tot_by_year[SPA6.tot_by_year$variable%in%c('prop.com','prop.rec', 'prop.pre'),],
            aes(YEAR, value, color=factor(variable, levels = c('prop.com','prop.rec', 'prop.pre')),linetype = factor(variable, levels = c('prop.com','prop.rec', 'prop.pre'))), stat="identity")+
  geom_hline(yintercept = 1.0, color = "red",linetype = "longdash") +
  #geom_segment(aes(x = 1997, xend = max(YEAR), y = ltm.SPA1A, yend = ltm.SPA1A), color = "blue", linetype = "solid")+
  ylim(0, 1.0)+ xlim(1983,2025)+
  scale_x_continuous(breaks = seq(1980, 2025, by = 5))+
  scale_color_manual(values=c("black", "yellow3", "skyblue3"), labels=c("Commercial Scallop - \u2265 80mm", "Recruit Scallop - 65mm-79mm", "Pre-recruit Scallop - 0mm-64mm"), name=NULL) +
  scale_linetype_manual(values=c("solid", "twodash", "dotted"), labels=c("Commercial Scallop - \u2265 80mm", "Recruit Scallop - 65mm-79mm", "Pre-recruit Scallop - 0mm-64mm"), name=NULL) +
  labs(
    title = "SPA 6")+
  theme_bw()+
  theme(axis.title.x=element_blank(), axis.title.y=element_blank(), plot.title = element_text(size = 10),
        legend.position = "none")
SPA6.plot

######## Combine Plots #################################################################################

panel <- cowplot::plot_grid(SPA1A.plot, SPA1B.plot, SPA3.plot, SPA4.plot, SPA6.plot,ncol=1,axis="lr")
panel

y.grob <- textGrob("Proportion of population",
                   gp=gpar(col="black", fontsize=12), rot=90)

x.grob <- textGrob("Year",
                   gp=gpar(col="black", fontsize=12))

plot.final <- grid.arrange(arrangeGrob(panel, left = y.grob, bottom = x.grob))

#Saved manually as Y:\Inshore\BoF\2025\Assessment\Figures\Proportion_of_100plus_Scallops_in_Survey_Tows_2025.png, width = 469, Height = 718
